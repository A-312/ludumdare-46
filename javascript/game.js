const e=800,t=600,a=new Phaser.Geom.Rectangle(0,400,728,200),r={type:Phaser.AUTO,width:800,height:600,parent:"phaser",pixelArt:!0,backgroundColor:"#76EEFE",input:{gamepad:!0},physics:{default:"arcade",arcade:{debug:!1}},scene:{preload:o,create:g,update:d}},l=new Phaser.Game(r);let i;const s={},n=[];function o(){i=l.scene.scenes[0],this.load.image("ground","res/ground.png"),this.load.image("grid","res/grid.png"),this.load.spritesheet("girl_walk","res/girl_walk.png",{frameWidth:32,frameHeight:64}),this.load.spritesheet("girl_handle","res/girl_handle.png",{frameWidth:32,frameHeight:64}),this.load.spritesheet("gull_fly","res/gull_fly.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("gull_handle","res/gull_handle.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("gull_eating","res/gull_eating.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("turtle_born","res/turtle_born.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("turtle_walk","res/turtle_walk.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("turtle_fear","res/turtle_fear.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("turtle_dead","res/turtle_dead.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("turtle[50]_fear","res/turtle50_fear.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("turtle_eated","res/turtle_eated.png",{frameWidth:32,frameHeight:32}),this.load.image("white","res/particles/white.png")}function g(){this.add.image(0,357,"ground").setOrigin(0),r.physics.arcade.debug&&this.add.image(0,300,"grid").setOrigin(0).setAlpha(.5);const e=new u(128,444),t=new h,a=new p;t.spawn(),a.spawn(),s.cursors=this.input.keyboard.createCursorKeys(),n.push(e.loop),n.push(t.loop),n.push(a.loop),s.zone=this.add.zone(832,400).setSize(200,200).setOrigin(0),this.physics.world.enable(s.zone),this.physics.add.collider(s.girl,[s.turtles,s.gulls]),this.physics.add.collider(s.turtles),this.physics.add.overlap(s.turtles,s.gulls),this.physics.add.overlap(s.turtles,s.zone),s.score=this.add.text(5,575,"",{color:"white",fontSize:24}).setOrigin(0),s.score.label="Score: ",s.score.value=0,s.numturtle=this.add.text(5,5,"",{color:"white",fontSize:24}).setOrigin(0),s.numturtle.label="Turtle in danger: ",this.physics.world.on("overlap",(e,t,a,r)=>{if(e.isTurtle&&t.isGull&&"gull_flying"!==t.texture.key){t.anims.play("gull_eating",!0),t.flipX=e.x>t.x,"turtle_eated"!==e.texture.key&&e.anims.play("turtle[50]_fear",!0),e.isAttacked=!0;const a=t.flipX?e.width/2-4:-e.width/2-6,r=e.x-a,l=e.y-(t.height-e.height)/2-5;if((Math.round(l)!==Math.round(t.y)||Math.round(r)!==Math.round(t.x))&&!t.isTweenEnable){t.isTweenEnable=!0;const a=this.tweens.add({targets:t,props:{x:{value:r},y:{value:l}},duration:300,ease:"linear",complete:500,onComplete:()=>{e.anims.play("turtle_eated",!0),t.isTweenEnable=!1,a.stop()}})}}})}function d(){if(n.forEach(e=>e.apply(this)),!s.turtles.getChildren().length){const e=new h,t=new p;e.spawn(),t.spawn(),this.physics.add.collider(s.girl,[s.turtles,s.gulls]),this.physics.add.collider(s.turtles),this.physics.add.overlap(s.turtles,s.gulls),this.physics.add.overlap(s.turtles,s.zone)}s.score.setText(s.score.label+s.score.value),s.numturtle.setText(s.numturtle.label+s.turtles.getChildren().length)}function u(e,t){i.anims.create({key:"girl_walk",frames:i.anims.generateFrameNumbers("girl_walk"),frameRate:4,yoyo:!0,repeat:-1}),i.anims.create({key:"girl_handle",frames:i.anims.generateFrameNumbers("girl_handle"),frameRate:.2,yoyo:!0,repeat:-1}),s.girl=i.physics.add.sprite(e,t,"girl_handle").setScale(2),s.girl.setSize(12,8).setOffset(12,56),s.girl.setCollideWorldBounds(!0),s.girl.body.setBoundsRectangle(a),s.girl.anims.play("girl_handle")}function h(){i.anims.create({key:"gull_fly",frames:i.anims.generateFrameNumbers("gull_fly"),frameRate:30,yoyo:!0,repeat:-1}),i.anims.create({key:"gull_eating",frames:i.anims.generateFrameNumbers("gull_eating"),frameRate:20,yoyo:!0,repeat:-1}),i.anims.create({key:"gull_handle",frames:i.anims.generateFrameNumbers("gull_handle"),frameRate:.2,yoyo:!0,repeat:-1}),s.gulls=i.physics.add.group({key:"gull_handle",quantity:8})}function p(){i.anims.create({key:"turtle_walk",frameRate:1.3,frames:i.anims.generateFrameNumbers("turtle_walk"),repeat:-1}),i.anims.create({key:"turtle_fear",frameRate:1,frames:i.anims.generateFrameNumbers("turtle_fear"),repeat:-1}),i.anims.create({key:"turtle[50]_fear",frameRate:1,frames:i.anims.generateFrameNumbers("turtle[50]_fear"),repeat:-1}),i.anims.create({key:"turtle_dead",frameRate:1,frames:i.anims.generateFrameNumbers("turtle_dead"),repeat:-1}),i.anims.create({key:"turtle_eated",frameRate:1,frames:i.anims.generateFrameNumbers("turtle_eated"),yoyo:!1,repeat:0}).addListener("complete",(e,t,a)=>{i.physics.add.sprite(a.x,a.y,"turtle_dead");s.score.value-=200,a.destroy()}),i.anims.create({key:"turtle_born",frames:i.anims.generateFrameNumbers("turtle_born"),frameRate:5,repeat:0}).addListener("complete",(e,t,a)=>{const r=i.add.particles("white").createEmitter({speed:100,life:500,scale:{start:.5,end:0},angle:{min:0,max:360},x:a.x,y:a.y,blendMode:"ADD"});setTimeout(()=>{a.play("turtle_walk"),a.setSize(0,8).setOffset(0,24),a.body.immovable=!1,a.body.useDamping=!0,a.body.setDrag(.9),r.stop()},100)});const e=a;s.turtles=i.physics.add.group({collideWorldBounds:!0,customBoundsRectangle:new Phaser.Geom.Rectangle(e.x+32,e.y,1e3,e.height),key:"turtle_walk",quantity:4,immovable:!0})}function m(e){return Math.floor(Math.random()*e)}u.prototype.loop=function(){let e=!1;s.cursors.left.isDown?(s.girl.setVelocityX(-200),s.girl.play("girl_walk",!0),s.girl.flipX=!0,e=!0):s.cursors.right.isDown&&(s.girl.setVelocityX(200),s.girl.play("girl_walk",!0),s.girl.flipX=!1,e=!0),s.cursors.up.isDown?(s.girl.setVelocityY(-200),s.girl.play("girl_walk",!0),e=!0):s.cursors.down.isDown&&(s.girl.setVelocityY(200),s.girl.play("girl_walk",!0),e=!0);try{const a=this.input.gamepad,r=a.total;if(0!==r){if(r>1&&!("num_gamepad"in s)){if("num_gamepad"in localStorage)s.num_gamepad=+localStorage.num_gamepad;else{const e=[];for(var t=0;t<r;t++)e.push(t+") "+a.gamepads[t].id);const l=`We detect ${r} gamepads, which do you want to use? `,i=+prompt(l+`num (0-${r-1}):\n`+e.join("\n"));s.num_gamepad=isNaN(i)||i<=0||i>r?0:i}try{navigator.getGamepads()[s.num_gamepad].vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:200,weakMagnitude:.2,strongMagnitude:.4})}catch(e){}}const l=a.getPad(s.num_gamepad);if(l.axes.length){const t=l.axes[0].getValue(),a=l.axes[1].getValue();0===t&&0===a||(s.girl.flipX=t<0,s.girl.play("girl_walk",!0),s.girl.setVelocityX(200*t),s.girl.setVelocityY(200*a),e=!0)}}}catch(e){console.error("gamepad things",e),localStorage.clear("num_gamepad")}s.girl.depth=s.girl.y+s.girl.height,e||(s.girl.setVelocity(0),s.girl.play("girl_handle",!0))},h.prototype.spawn=function(){s.gulls.getChildren().forEach(e=>{e.isGull=!0,e.setSize(48,32).setOffset(8,32),e.body.onOverlap=!0});const e=a,t=new Phaser.Geom.Rectangle(e.x+320,e.y,e.width-320,e.height-32);Phaser.Actions.RandomRectangle(s.gulls.getChildren(),t),s.gulls.getChildren().forEach(e=>{e.x<500&&(e.flipX=!0),e.anims.play("gull_handle")})},h.prototype.loop=function(){s.gulls.getChildren().forEach(e=>{const t=e.body.velocity;e.y>=400&&(0===t.x&&0===t.y||(e.play("gull_fly",!0),e.flipX=t.x>0||e.flipX&&0===t.x,t.y<20&&(t.y=-200,t.x/=2)),t.y>0&&(t.y*=-1)),"gull_fly"!==e.texture.key&&(e.depth=e.y+e.height/2)})},p.prototype.spawn=function(){const e=a;s.turtles.getChildren().forEach(e=>{e.isTurtle=!0});const t=new Phaser.Geom.Rectangle(e.x+32,e.y,280,e.height-20);Phaser.Actions.RandomRectangle(s.turtles.getChildren(),t),s.turtles.getChildren().forEach(e=>{e.anims.play("turtle_born")})},p.prototype.loop=function(){if(s.turtles.getChildren().forEach(e=>{let t=0;e.depth=e.y;const a=e.body.velocity;a.x<=5&&"turtle_walk"===e.texture.key&&(a.x=10*(e.flipX?-1:1)),e.isAttacked?t=-10:e.body.touching.none?e.waitToWalk<+new Date&&e.play("turtle_walk",!0):(e.play("turtle_fear",!0),e.waitToWalk=+new Date+2e3,e.body.touching.right?e.flipX=!0:e.body.touching.left&&(e.flipX=!1)),e.depth=e.y+e.height/2+t}),!s.zone.body.touching.none&&s.zone.body.wasTouching.none&&s.num_gamepad){try{navigator.getGamepads()[s.num_gamepad].vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:1e3,weakMagnitude:.5,strongMagnitude:1})}catch(e){}s.turtles.getChildren().forEach(e=>{800<=e.x&&(s.score.value+=100,e.destroy())})}};
//# sourceMappingURL=../javascript/game.js.map
